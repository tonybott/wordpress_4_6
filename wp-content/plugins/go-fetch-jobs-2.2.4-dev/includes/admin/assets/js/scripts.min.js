jQuery(document).ready(function(e){function t(){f("[section=taxonomies], [section=meta], [section=source]"),e("input.hidden").closest("tr").hide(),e("#templates_list").val(""),e(".rss-load-images").prop("checked",!1)}function a(t,a){var t=t?t:e("[class*=provider-expand]");t.each(function(){var t=e("."+e(this).attr("data-child")),n=e(this).attr("data-default"),s="undefined"==typeof a?t.is(":visible"):a;n=(s?"- ":"+ ")+n,e(this).text(n)})}function n(t){e(".provider-expand-feed-builder").length?e(".provider-expand-feed-builder").click():e(".provider-expand-feed-manual-setup").click(),a(),void 0!==t.feed.query_args_sep&&e(".feed-builder input[name=feed-params-sep]").val(t.feed.query_args_sep),void 0!==t.feed.query_args&&(e("[class*=opt-param]").hide(),e.each(t.feed.query_args,function(t,a){e(".feed-builder .opt-param-"+t).show();var n=Object.keys(a)[0],s=void 0!=a[n].default_value?a[n].default_value:"",o=void 0!=a[n].placeholder?a[n].placeholder:"",i=void 0!=a[n].required?a[n].required:"",r=void 0!=a[n].is_prefix?a[n].is_prefix:"";"domain_l"===n&&e(".feed-builder input[name=feed-param-"+t+"]").attr("data-regex",a[n].regex),i&&e(".feed-builder .opt-param-"+t+" label").append(" "+i),e(".feed-builder input[name=feed-param-"+t+"]").val(n),e(".feed-builder input[name=feed-param-"+t+"]").attr("data-default",s),o&&e(".feed-builder input[name=feed-"+t+"]").attr("placeholder",o),r&&e(".feed-builder input[name=feed-param-"+t+"]").attr("data-prefix",r)})),e(".feed-builder input[name=feed-url]").val(t.feed.base_url).keyup(),e(".feed-builder input[name=feed-url]").attr("data-default",t.feed.base_url)}function s(){var t=e("input[name=feed-url]").val(),a=e(".feed-builder input[name=feed-params-sep]").val();return"undefined"==typeof t?t:("&"===a?t+=t.indexOf("?")<0?"?":"&":t.indexOf(a)<0&&(t+=a),t)}function o(t){var a=b,n=e(".feed-builder input[name=feed-params-sep]").val(),s=[];e(".feed-builder .params input[name*=feed-]").each(function(){var a=e(this).attr("data-qarg"),n=e("input[name="+a+"]").attr("data-default");n=void 0!=n?n:"",value=void 0!=t[a]?t[a]:"",s[a]=value?value:n}),t=s;for(var o in t)t.hasOwnProperty(o)&&void 0!=t[o]&&void 0!=t[o]&&(("&"===n&&"?"!==a.slice(-1)||"&"!==n)&&n!==a.slice(-1)&&(a+=n),a+=t[o]);e(".provider-rss-custom").text(a),e(".provider-rss-custom").prop("href",a)}function i(t){var a=e("#rss_feed_import").val().split("?")[0];if(void 0!==e("#rss_feed_import").attr("data-saved-url"))var n=e("#rss_feed_import").attr("data-saved-url").split("?")[0];return a!==n}function r(t,a){e.each(t,function(t,n){a||e('input[name="source['+t+']"]').val(n).change(),e('input[name="source['+t+']"]').attr("data-original",n).change()}),f("[section=source]")}function d(t){var a=[];void 0!==goft_jobs_admin_l18n.default_query_args&&a.push(goft_jobs_admin_l18n.default_query_args),void 0!==t.feed&&a.push(t.feed.query_args),e.each(a,function(t,a){void 0!==a&&e.each(a,function(t,a){var n="";""!==Object.keys(a)[0]&&0===Object.keys(a)[0]?(n=a,t=n):n=Object.keys(a)[0],param_value=h(e("#rss_feed_import").val(),n),e("input[data-core-name="+t+"]").val(param_value).change()})})}function l(t){e(".tr-advanced, .tr-advanced + .section-advanced").addClass("tr-advanced-"+("advanced"===t?"show":"hide")),e(".tr-advanced, .tr-advanced + .section-advanced").removeClass("tr-advanced-"+("advanced"===t?"hide":"show"))}function c(){k&&e(".tr-advanced").promise().done(function(){e(".tr-advanced-show").show(),e(".tr-advanced-hide").hide()})}function p(t){t?(e(".import-notes").closest("tr").hide(),e(".import-posts").fadeIn()):(e(".import-notes").closest("tr").fadeIn(),e(".import-posts").hide()),_(t)}function f(t){var a="";e(t).each(function(){var t=e(this).attr("section"),n="section-"+t+"-values",s=e(this).closest("tr"),o=e("th",s).text(),i="-",r=classes="";if(e('select, input[type!="button"], textarea',s).each(function(){if(r="",e(this).is("select"))r=e(this).find(":selected").text();else if(e(this).is(":checkbox"))r=e(this).is(":checked")?goft_jobs_admin_l18n.label_yes:goft_jobs_admin_l18n.label_no;else if(e(this).val()){if(r=e(this).val(),classes=e(this).attr("class"),g(r)){var t=document.createElement("a");t.href=r,r=null!==t.pathname.match(/\.(jpeg|jpg|gif|png|ico)$/)?'<img src="'+r+'" class = "goft-image-thumb">':'<a href="'+r+'" class = "goft-link">'+r+"</a>"}}else""!==e(this).attr("data-default")&&(r=e(this).attr("data-default"))}),t!==a)if(e("."+n).length)e("."+n).html("");else{var d='<tr class="section-advanced temp-tr-hide"><td><a href="#" class="section-expand" expand="'+t+'">'+goft_jobs_admin_l18n.msg_advanced+'</a></td><td class="tip">&nbsp;</td><td class="section-values '+n+'" colspan=5></td></tr>';e(".section-"+t).parents("tr").after(d)}r||(r=i);var l='<p class="goft-basic" data-classes="'+classes+'"><strong>'+o+": </strong><span>"+r+"</span></p>";e("."+n).append(l),a=t})}function _(t){var a=e(".temp-tr-hide"),n=e(".temp-tr-hide.tr-hide");t?a.fadeIn():(a.fadeOut(),n.removeClass("temp-tr-hide"))}function u(t){if(!t.id){var a="dashicons-"+(1===y?"minus":"plus");if(y++,t.children){var n=e('<span class="goft-jobs-group">'+t.text+'<span class="dashicons-before '+a+' expand-minimize"></span></span>');return n}return t.text}var n=e("<span>"+e(t.element).val()+'<span class="provider-desc">'+e(t.element).data("desc")+"</span></span>");return n}function v(e){var t,a=/\/\/www\.(.*?)[\/\?]$/;if(null!==(t=a.exec(e)))for(var n=(t.length,t.length-1);n>=0;n--)if(void 0!==t[n]&&""!==t[n])return"rss-"+t[n];return"my-rss-feed"}function g(e){var t=/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-]*)?\??(?:[\-\+=&;%@\.\w]*)#?(?:[\.\!\/\\\w]*))?)/g,a=new RegExp(t);return a.test(e)}function h(e,t){t=t.replace(new RegExp("]","gm"),/[\[]/,"\\[").replace(new RegExp("]","gm"),/[\]]/,"\\]");var a=new RegExp("[\\?&/]"+t+".([^&#/]*)"),n=a.exec(e);return null===n?"":decodeURIComponent(n[1].replace(new RegExp("]","gm"),/\+/g," "))}var b="",j=[],x="",k=!1,y=0,w=e("#templates_list + .description");e("form[name=post]").validate({errorElement:"div",errorPlacement:function(e,t){e.insertAfter(t.closest("label"))}});e("#templates_list").select2({placeholder:goft_jobs_admin_l18n.label_templates}),e("#providers_list").select2({minimumResultsForSearch:20,templateResult:u,placeholder:goft_jobs_admin_l18n.label_providers}).maximizeSelect2Height();var C={details:"form",detailsAttribute:"data-geo"};e(".geocomplete").length&&e(".geocomplete").geocomplete(C),e("#from_date").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,onClose:function(t){e("#to_date").datepicker("option","minDate",t),e("#to_date").val()||e("#to_date").val(e("#from_date").val())}}),e("#to_date").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,onClose:function(t){e("#from_date").datepicker("option","maxDate",t)}}),t(),e(document).on("click",".select2-results__options li",function(){e(this).find("li").toggle()}),e(document).on("click",".select2-results__option",function(){e(".expand-minimize",this).hasClass("dashicons-minus")?e(".expand-minimize",this).removeClass("dashicons-minus").addClass("dashicons-plus"):e(".expand-minimize",this).removeClass("dashicons-plus").addClass("dashicons-minus")}),e(document).on("guided_tour.init",function(t,a){l("advanced"),e(document).on("goftj_rss_content_loaded",function(t,a){e(document).guided_tour()}),e(document).on("click",".button.gofetch-jobs-tour1_0_step4_2",function(){e("#rss_feed_import").val(e("#rss_feed_import").data("example")),e(".import-feed").click()})}),e(document).on("change","#goft-settings-type",function(t){var a=e("#goft-settings-type:checked").val(),n={action:"goft_jobs_toggle_settings",toggle:a,_ajax_nonce:goft_jobs_admin_l18n.ajax_nonce};e.post(goft_jobs_admin_l18n.ajaxurl,n),l(a),c()}),e(document).on("goftj_rss_content_loaded",function(e,t){k=!0,c()}),e("#goft-settings-type").trigger("change"),e(document).on("click",".refresh-templates",function(t){e("#templates_list option").filter(function(){return this.value}).remove(),e(".goft_jobs.processing.templates").length||(w.hide().after('<div class="goft_jobs processing templates">&nbsp;</div>'),e(".import-feed").prop("disabled",!0));var a={action:"goft_jobs_update_templates_list",_ajax_nonce:goft_jobs_admin_l18n.ajax_nonce};return e.post(goft_jobs_admin_l18n.ajaxurl,a,function(t){void 0!==t&&void 0!==t.templates&&(e.each(t.templates,function(t,a){var n=!1;e("#templates_list option").filter(function(t){return-1!==e(this).attr("value").indexOf(a)?void(n=!0):void 0}),n||e("#templates_list").append(e("<option>",{value:a}).text(a))}),e("#templates_list").trigger("change")),e(".goft_jobs.processing.templates").remove(),e(".import-feed").prop("disabled",!1),w.show()},"json"),t.preventDefault(),!1}),e(document).on("click",".import-feed",function(t){var a=e("#rss_feed_import").val();if(!a)return alert(goft_jobs_admin_l18n.msg_specify_valid_url),void t.preventDefault();p(!1),e(".goft_jobs.no-jobs-found").remove(),e(".goft_jobs.processing.feed").length||(e("input[name=import_feed]").hide(),e("input[name=import_feed]").after('<span class="goft_jobs processing feed">&nbsp;</span>').after('<a class="button-secondary cancel-feed-load">'+goft_jobs_admin_l18n.cancel_feed_load+"</a>"),e("input",w).prop("disabled",!0));var n={action:"goft_jobs_import_feed",url:a,load_images:e("input[name=load_images]").is(":checked"),force_feed:e("input[name=force_feed]").is(":checked"),_ajax_nonce:goft_jobs_admin_l18n.ajax_nonce};return x=e.post(goft_jobs_admin_l18n.ajaxurl,n,function(t){if(void 0!==t)if(p(!1),void 0!==t.error)e(".force-feed").show(),e("input[name=load_images]").closest("p").after('<span class="goft_jobs no-jobs-found feed"> '+goft_jobs_admin_l18n.msg_invalid_feed+": "+t.error);else if(t.total_items>0){e(".goft_jobs_jobs_found").remove(),e(".goft_jobs_table").html(t.sample_item),e(".goft_jobs_table").after('<h4 class="goft_jobs_jobs_found code">'+goft_jobs_admin_l18n.msg_jobs_found+": "+t.total_items+"</h4>");var n=e("#templates_list").val()&&!i();t.provider&&(r(t.provider,n),d(t.provider)),e("#templates_list").val()||e("#template_name").val(v(a)),_(!0),p(!0),e.event.trigger({type:"goftj_rss_content_loaded"})}else e("input[name=load_images]").closest("p").after('<span class="goft_jobs no-jobs-found feed"> '+goft_jobs_admin_l18n.msg_no_jobs_found+"</span>");e(".goft_jobs.processing").remove(),e(".cancel-feed-load").remove(),e("input[name=import_feed]").show(),e("input",w).prop("disabled",!1),f("[section=taxonomies], [section=meta], [section=source]")},"json"),t.preventDefault(),!1}),e(document).on("click",".cancel-feed-load",function(t){return x.abort(),e(this).remove(),e(".goft_jobs.processing").remove(),e("input[name=import_feed]").show(),e("input",w).prop("disabled",!1),t.preventDefault(),!1}),e(document).on("click",".save-template",function(t){var a=e("#template_name").val();if(!a)return void alert(goft_jobs_admin_l18n.msg_template_missing);e(".goft_jobs.processing.save").length||(e(".save-template").hide(),e(".save-template").after('<span class="goft_jobs processing save">&nbsp;</span>'));var n={action:"goft_jobs_save_template",template:a,fetch_images:Number(e("input[name=load_images]").is(":checked")),force_feed:Number(e("input[name=force_feed]").is(":checked")),smart_tax_input:e("select[name=smart_tax_input]").val(),rss_feed_import:e("#rss_feed_import").val(),_wpnonce:goft_jobs_admin_l18n.ajax_save_nonce};return e.each(["tax_input","meta","source"],function(t,a){e('[name*="'+a+'"]').each(function(t,a){e(a).is(":checkbox")?n[e(this).prop("name")]=e(a).is(":checked")?e(this).attr("data-default"):"":n[e(this).prop("name")]=e(this).val()})}),e.post(goft_jobs_admin_l18n.ajaxurl,n,function(t){if(void 0!==t&&"1"===t){e(".save-template").show(),e(".save-template").after('<span class="template-saved-msg"> '+goft_jobs_admin_l18n.msg_template_saved+"</span>");var n=!1;e("#templates_list option").filter(function(t){return-1!==e(this).attr("value").indexOf(a)?void(n=!0):void 0}),n||e("#templates_list").append(e("<option>",{value:a}).text(a)),e("#templates_list").val(a)}else e(".save-template").after('<span class="template-saved-msg"> '+goft_jobs_admin_l18n.msg_save_error+"</span>");e(".template-saved-msg").delay(2e3).fadeOut(),e(".goft_jobs.processing.save").remove()}),t.preventDefault(),!1}),e(document).on("change","#templates_list",function(){var t=e(this);_(!1),p(!1),e(".goft_jobs.processing.templates").length||w.hide().after('<div class="goft_jobs processing templates">&nbsp;</div>');var a={action:"goft_jobs_load_template_content",template:e(this).val(),_ajax_nonce:goft_jobs_admin_l18n.ajax_nonce};e.post(goft_jobs_admin_l18n.ajaxurl,a,function(a){if(a){var n=a.rss_feed_import;e("#rss_feed_import").val(n),e("#template_name").val(t.val()),e("input[name=load_images]").prop("checked",Boolean(a.fetch_images)),e("input[name=force_feed]").prop("checked",Boolean(a.force_feed)),e("select[name=smart_tax_input]").val(a.smart_tax_input),e("#rss_feed_import").attr("data-saved-url",n),e.each(["tax_input","meta","source"],function(t,n){e.each(a[n],function(t,a){var s='[name="'+n+"["+t+']"]';if(e(s).is(":checkbox"))return void(a?e(s).prop("checked",!0):(e(s).val(e(s).attr("data-default")),e(s).prop("checked",!1)));if(e(s).val(a).prop("selected",!0).change(),e(s).hasClass("goft-image")&&a){var o=e(s).closest("td");e("img",o).attr("src",a)}})}),e(".import-feed").click(),e(".force-feed").toggle(e("input[name=force_feed]").is(":checked"))}else e("#rss_feed_import").val("");e(".goft_jobs.processing.templates").remove(),w.show()},"json"),e("#providers_list").val("").change()}),e("[section=taxonomies],[section=meta], [section=source]").on("change",function(){f("[section="+e(this).attr("section")+"]")}),e(document).on("change","#providers_list",function(){var t=e(this);if(e(".goft_jobs.processing.providers").remove(),!t.val())return void e(".providers-placeholder").closest("tr").fadeOut();e(".goft_jobs.processing.templates").length||e("#providers_list").next(".select2").after('<div class="goft_jobs processing providers">&nbsp;</div>');var a={action:"goft_jobs_load_provider_info",provider:t.val(),_ajax_nonce:goft_jobs_admin_l18n.ajax_nonce};e.post(goft_jobs_admin_l18n.ajaxurl,a,function(a){a&&(e(".providers-placeholder-content").html(a.setup).closest("tr").fadeIn(),e(".providers-placeholder-content").append('<a class="dashicons-before dashicons-dismiss close-provider" title="'+goft_jobs_admin_l18n.title_close+'"></a>'),e(".close-provider").click(function(){t.val("").change()}),e(".providers-placeholder").slideDown(),n(a.provider)),e(".goft_jobs.processing.providers").remove()},"json"),b="",j=[]}),e(document).on("click","a.provider-rss, a.provider-rss-custom",function(t){return e(".rss-copied-msg").remove(),e("input[name=rss_feed_import]").val(e(this).attr("href")).addClass("input-feed-pasted"),e(this).after('<span class="rss-copied-msg"> '+goft_jobs_admin_l18n.msg_rss_copied+"</span>").fadeIn(),e(".rss-copied-msg").delay(1e3).fadeOut(function(){e("input[name=rss_feed_import]").removeClass("input-feed-pasted")}),t.preventDefault(),!1}),e(document).on("click","[class*=provider-expand]",function(t){var n=e(this),s=e("."+n.attr("data-child"));return s.slideToggle(a(n,!s.is(":visible"))),t.preventDefault(),!1}),e(document).on("keyup",".feed-builder input[name*=feed]",function(){var t=e(this).attr("data-qarg"),a=e("input[name="+t+"]").val(),n=e(this).val(),s=e(".feed-builder input[name=feed-params-sep]").val(),i=e("input[name="+t+"]").attr("data-prefix");j[t]=[],n.length||(n=""),n=encodeURIComponent(n),a+="&"===s?"="+n:(i?"":s)+n,j[t]=a,o(j)}),e(document).on("keyup",".feed-builder input[name=feed-url]",function(){b=s();var t="domain_l"===e(".feed-builder input[name=feed-param-location]").val();if(t){var a=new RegExp(e(".feed-builder input[name=feed-param-location]").attr("data-regex"));null!==(m=a.exec(b))&&e(".feed-builder input[name=feed-location]").val(m[1])}e(".feed-builder .params input[name*=feed-]:visible").keyup()}),e(document).on("click",".reset-feed-url",function(t){return e(".feed-builder input[name=feed-url]").val(e(".feed-builder input[name=feed-url]").attr("data-default")).keyup(),t.preventDefault(),!1}),e(document).on("click",".clear_span_dates",function(){e("."+e(this).attr("data-goft_parent")).val("")}),e(document).on("click",".reset-val",function(t){var a=e('input[name="'+e(this).attr("data-parent")+'"');return e(a).val(e(a).attr("data-original")).change(),t.preventDefault(),!1}),e(".section-expand").on("click",function(t){var a=e(this).attr("expand"),n="[section="+a+"]",s=this;return e(".section-"+a+"-values").toggle().addClass("temp-tr-hide"),e(n).closest("tr").toggle(function(){e(this).addClass("temp-tr-hide"),e(this).is(":visible")?e(s).text(goft_jobs_admin_l18n.simple):e(s).text(goft_jobs_admin_l18n.advanced)}),f("[section=taxonomies], [section=meta], [section=source]"),t.preventDefault,!1}),e("#_goft_jobs_period_custom").closest("tr").hide(),e(document).on("change","#_goft_jobs_period",function(){"custom"==e(this).val()?e("#_goft_jobs_period_custom").closest("tr").fadeIn():e("#_goft_jobs_period_custom").closest("tr").hide()}),e("#_goft_jobs_period").trigger("change")});